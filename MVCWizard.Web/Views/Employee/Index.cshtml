@using MVCWizard.Web.Application
@model IEnumerable<MVCWizard.Web.Models.EmployeeDto>

@{
    ViewData["Title"] = "Employees List";
}
<h1>Employees List</h1>
<p>
    <a asp-action="Create">Create New Emplyee</a>
</p>

        <div class="accordion" id="accordionExample">
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingOne">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                        Get Emp partial using data url:
                    </button>
                </h2>
                <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
                    <div class="accordion-body">

                        <div id="CompletedSections"
                             data-url="@Url.Action("GetEmployeesAsPartialView", "Employee")">
                        </div>
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingTwo">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                        Get Emp partial using partial TAG:
                    </button>
                </h2>
                <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionExample">
                    <div class="accordion-body">
                        <partial name="_EmployeeList.cshtml" for="@Model" />
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingThree">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                        Get Emp Div By Ajax:
                    </button>
                </h2>
                <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionExample">
                    <div class="accordion-body">
                        <div id="emp_div">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        Employee Details:
        <br />
        
        <br />
        <div id="dialog" style="display: none"   class="ui-widget">
        </div>
        
        <br />
        <div id="div_emp_details"  class="ui-widget" >
        </div>
        
<!-- The Modal -->
<div class="modal" id="myModal">
    <div class="modal-dialog">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Modal Heading</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <!-- Modal body -->
            <div class="modal-body">
                <div id="div_modal_body">

                </div>
            </div>

            <!-- Modal footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
            </div>

        </div>
    </div>
</div>


@section Scripts {

     @{ await Html.RenderPartialAsync(@Constants.PartialNames.ValidationScriptsPartial); }

<script>
     $(document).ready(function ()
{

    //btn_modal
    //$("#btn_modal").on
    //("click",
    //    function ()
    //{
    //    var data_url = '@Url.Action("GetEmployeeDetails", "Employee", new {emp_id=1})';
    //    show_modal(data_url, 'Employee Details');
    //}
    //);

    ////Prepare Show details in Dialog:
    //$("#dialog").dialog(
    //{
    //    autoOpen: false,
    //    modal: true,
    //    title: "View Employee Details",
    //    show:
    //    {
    //        effect: "blind",
    //        duration: 500
    //    },
    //    hide:
    //    {
    //        effect: "blind",
    //        duration: 500
    //    }
    //}
    //);

    ////Prepare edit in Dialog:
    //$("#dialog_edit").dialog(
    //{
    //    autoOpen: false,
    //    modal: true,
    //    close: function (event, ui)
    //    {
    //        load_employees();
    //    },
    //    title: "Edit Employee Details"
    //}
    //);

    //////////////////////////////////////////
    //Get Emp partial using data url:
    load_employees();

    //Get Emp Div By Ajax:
    $.ajax(
    {
        type: "GET",
        url: "/Employee/GetEmployeesAsPartialView",
        contentType: "application/json; charset=utf-8",
        dataType: "html",
        cache: false,
        data: {},
        success: function (response)
        {
            $("#emp_div").html(response);

            //add code for show employee Details:
            add_events_to_button();
        }
    }
    );

    function add_events_to_button()
    {
        //code for show employee Details:
        $("[data-id]").on
        ("click",
            function ()
        {

            var empid = $(this).attr('data-id');
            var get_emp_det_url = $(this).attr('data-url');
            console.log('get_emp_det_url', get_emp_det_url);

            $("#div_emp_details").load(get_emp_det_url);
        }
        );
        ////////////////////////////////////
        //code for show employee Edit:
        $("[data-edit]").on
        ("click",
            function ()
        {
            //debugger;
            var get_emp_edit_url = $(this).attr('data-url');
            show_modal(get_emp_edit_url, 'Edit Employee');
        }
        );

        //Add Code for show employee  Details in dialog:
        $("[data-empid]").on
        ("click",
            function ()
        {
            var empid = $(this).attr('data-empid');
            //debugger;
            console.log('empid', empid);
            var data_url_det = $(this).attr('data-url');
            show_modal(data_url_det, 'Employee Details');

        }
        );

        //Show delete in Dialog:
        $("[data-empid-del]").on
        ("click",
            function ()
        {

            var empid = $(this).attr('data-empid-del');
            var del_url = $(this).attr('data-url');
            console.log('del_url', del_url);
            var dialogitem = $('#dialog');

            dialogitem.load
            (del_url,
                function ()
            {
                dialogitem.dialog('open');
            }
            );
        }
        );

    } //end of 'add_events_to_button'


    function load_employees()
    {
        var item = $('#CompletedSections');
        var url = item.data("url");

        item.load(url, function ()
        {
            add_events_to_button();
        }
        );
    }

    function show_modal(data_url, title)
    {
        $("#div_modal_body").load(
            data_url,
            function ()
        {
            //popup with default options
            //var myModal = new bootstrap.Modal('#myModal');

            //popup without backdrop
            //var myModal = new bootstrap.Modal('#myModal',{backdrop: false});

            //popup with disabled ckick outside
            var myModal = new bootstrap.Modal('#myModal',
            {
                backdrop: 'static',
                keyboard: false
            }
                )

                $(".modal-title").html(title);
            myModal.show();
        }
        );
    }

    $("#myModal").on('hide.bs.modal', function ()
    {
        //alert('The modal is about to be hidden.');
        $('.modal-backdrop').remove();
    }
    );

}
); //end of JQuery load


</script>

 }
